#!/usr/bin/env ruby
require 'trollop'
require 'cfn_nag'
require 'logging'

opts = Trollop::options do
  opt :input_json, 'Cloudformation template to nag on', type: :string, required: true
  opt :debug, 'Enable debug output', type: :boolean, required: false, default: false
end

def configure_logging(opts)
  logger = Logging.logger['log']
  if opts[:debug]
    logger.level = :debug
  else
    logger.level = :info
  end

  logger.add_appenders Logging.appenders.stdout
end

configure_logging(opts)
exit CfnNag.new.audit(opts[:input_json])